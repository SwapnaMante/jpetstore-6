pipeline {

agent any

environment {
   
    ArtifactID = readMavenPom().getArtifactId()
    VERSION = readMavenPom().getVersion()
	PROJECT_NAME = "jpetstore"
    }
	tools{
	Sonarscanner 'SonarScanner-4.7'
	Maven 'Maven 3.8.5'
	}
	
stages {
        
  stage('PrintVariables') {
            steps {
				echo "${ArtifactID}"
                echo "${VERSION}"
            }

        }	
  stage('Build') {
            steps {
			   
               bat 'mvn clean package'
            }
        }
  stage('Sonar Analysis')	{
			steps {
				withSonarQubeEnv('Sonarqube-8.9.8') {
				bat '''$SCANNER_HOME/bin/sonar-scanner \
			    -Dsonar.java.binaries=build/classes/java/ \
			    -Dsonar.projectKey=$PROJECT_NAME \
			    -Dsonar.sources=.'''
    }
	
	}
}
}